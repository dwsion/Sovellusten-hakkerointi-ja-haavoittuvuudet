**Tehtävät**

x) Lue/katso/kuuntele ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.)

    OWASP: OWASP Top 10: A01 Broken Access Control

    Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf

    PortSwigger: Access control vulnerabilities and privilege escalation

    Karvinen 2006: Raportin kirjoittaminen

    Vapaaehtoinen: PortSwigger 2020: What is SQL injection? - Web Security Academy (noin 10 min video)

a) Murtaudu 010-staff-only. Ks. Karvinen 2024: Hack'n Fix

b) Korjaa 010-staff-only haavoittuvuus lähdekoodista. Osoita testillä, että ratkaisusi toimii.

c) Ratkaise dirfuzt-1 artikkelista Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf. Tämä auttaa 020-your-eyes-only ratkaisemisessa.

d) Murtaudu 020-your-eyes-only. Ks. Karvinen 2024: Hack'n Fix

e) Korjaa 020-your-eyes-only haavoittuvuus. Osoita testillä, että ratkaisusi toimii.

g) Vapaaehtoinen. Johdantotehtävä, joka auttaa 010-staff-only ratkaisemisessa. Ratkaise Portswigger Academyn "Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data".

h) Vapaaehtoinen. Johdantotehtävä, joka auttaa 010-staff-only ratkaisemisessa. Ratkaise Portswigger Academyn "Lab: SQL injection vulnerability allowing login bypass"

**Ympäristö**

Tehtävän suorittamiseen käytin seuraavanlaista tietokonetta:

Lenovo X1 /Intel Core Ultra 7 155U/14WUXGA/32GB/1Tt SSD/5G/W11P/Intel Wi-Fi 6E AX211

Virtualboxissa Debian 13.0 amd64 xfce Linux

># x)


## OWASP


## Fuff

- Komentoriviltä käytettävä työkalu, jolla voidaan testata järjestelmiä automaattisesti

- Esimerkiksi piilossa olevia verkkohakemistoja voidaan löytää webpalvelimelta, kun syötetään

  sanalistoja URL-polun perään (http://target.com/FUZZ), jossa siis sana FUZZ korvataan sanakirjan

  sanoilla ja testataan vastaako palvelin.

  - On erittäin nopea, koska se käyttää rinnakkaisia HTTP-pyyntöjä
 
          $ ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ

        Yllä oleva komento kokeilee sanakirjan common.txt jokaista riviä FUZZ-sanan tilalle

## Portswigger


## Hyvä raportti 

- Täsmällinen ja sisältää tarkat tiedot tehdyistä asioista, kuten ympäristö, laitteisto jne.

- Lopputulos ja vaiheet toistettavissa kenen tahansa raportin lukijan toimesta 

- Helppolukuinen ja ymmärrettävä

- raportoidaan onnistumiset ja epäonnistumiset

- Viittaa lähteisiin ja ei ole plagioitu 

- On totuudenmukainen 

># a)

Päätin aloittaa tämän tehtävän suorittamisen tekemällä ensin g- ja h-kohdan vapaaehtoiset johdantotehtävät. Sitä ennen tein uuden Linux-koneen tehtäviä varten.

Ajoin koneelle  ohjeen mukaisesti:

>sudo apt-get update

>sudo apt-get -y install wget unzip micro

<img width="813" height="297" alt="image" src="https://github.com/user-attachments/assets/778c048e-851e-41bb-9598-881b1f4c49b3" />

>wget https://terokarvinen.com/hack-n-fix/teros-challenges.zip

>unzip teros-challenges.zip

Latasin Teron sivuilta tiedoston 

<img width="832" height="295" alt="image" src="https://github.com/user-attachments/assets/fcf17212-e77e-4c7b-8897-219ccb12d666" />


ja purin sen auki

<img width="815" height="310" alt="image" src="https://github.com/user-attachments/assets/3a160ad4-9a1e-4d0c-a096-5a4875d92d4b" />


Yritin seuraavaksi ohjeen mukaan kirjoitella komentoja, joista tuli virheilmoitus, mutta jatkoin eteenpäin ja asensin python3-flask jne..


<img width="1072" height="457" alt="image" src="https://github.com/user-attachments/assets/5ff1cc15-55c1-4088-9c56-46941203af21" />



Käynnistin serverin ja surffasin ko. osoitteeseen (http://127.0.0.1:5000):

<img width="1046" height="222" alt="image" src="https://github.com/user-attachments/assets/52d32ba0-b53d-4ea7-8180-567a905023c0" />



Ja sieltähän se ensimmäinen maali lopulta löytyi:

<img width="1872" height="816" alt="image" src="https://github.com/user-attachments/assets/52d3121d-1c0e-4980-8c38-b9a5bc2b0d07" />



Huomasin tässä kohtaa, kun katsoin vihjeitä Portswiggeristä, että joudun ilmeisesti lataamaan seuravaksi burp Suiten, joten tein sen seuraavaksi.

Kokeilin useamman tunnin opiskella Burpin käyttöä ja katselin videoita, mutta olin ihan jumissa. Katsoin (Youtubesta) videon, jolla ratkaistaan Lab: SQL injection

vulnerability allowing login bypass ja siitä sainkin ensimmäisen idean kokeilla muokata lähetettävää tietoa ja onnistuin saamaan internal server errorin lähettämällä

palvelimelle ( pin = ') ja tämä on videon mukaan ainakin hyvä asia jo.


<img width="1476" height="569" alt="image" src="https://github.com/user-attachments/assets/c811da57-29a9-4afa-860e-97af63ed5785" />



<img width="986" height="234" alt="image" src="https://github.com/user-attachments/assets/2e97cb02-9984-46c0-ab6c-044087b99bc9" />



Yritin useamman tunnin tuohon pin-koodin kohtaan kirjoittaa jotain muuta, välillä internetistä erilaisia videoita katsellen ja sql injektion perusteita selaillen, mutta en saanut edistystä millään.

Huomasin sitten vinkeistä, että voisin käyttää kehittäjän työkaluja ja tutkia lähdekoodia. Ymmärsin kyllä tehtävänannosta, että sitä ei saisi tehdä, joten kokeilin ilman. Vihjeen mukaan tutkin kenttää, joka otti ainoastaan vastaan numeroita ja syynä

selkeästi oli html-koodissa > input type= number. Mietin, että jos tuohon vaihtaisi number tilalle  ensin text ja asitten syöttäisi injektion kenttään, niin olisiko siitä hyötyä.



<img width="1287" height="714" alt="image" src="https://github.com/user-attachments/assets/9f9ff7e3-0419-4f1f-a302-a2e202978704" />

Kokeilin kenttään syöttää tuon Teron vihjeessä mainitun OR 1=1; --


>SQL injection
"SELECT * FROM foo WHERE true", matches each line where WHERE is true.
Often used as "authentication bypass" or "login bypass", you can add "OR 1=1", a clause that's always true. And "false or true" is still true.
To get rid of the end of SQL query, you can use comment "-- " or write query to have the correct strings etc. open or close.
Often only the first row of results is shown. Use "LIMIT offset, count" to get second, third etc result. For example, "LIMIT 2,1" shows results starting from 2, show 1 result.
Use database library facilities to combine user data with SQL. This is often called "prepared queries" or "parametrized queries"
This code uses SQLAlchemy for the database library ( Tero Karvinen)

<img width="621" height="510" alt="image" src="https://github.com/user-attachments/assets/af49f4b0-a964-434f-a940-700b41101d77" />


<img width="917" height="529" alt="image" src="https://github.com/user-attachments/assets/c5d7ab6c-d0d9-4566-aae1-3ebd5e29f21d" />


Mitään ei kuitenkaan tapahtunut, sivu näytti tältä:


<img width="770" height="461" alt="image" src="https://github.com/user-attachments/assets/2d685c56-fba7-4c8b-8e3a-f96e396c75cc" />


Palasin katsomaan netistä aineistoja ja huomasin, että niissä tuon lausekkeen ympärillä, edessä ja takana oli käytetty hipsuja, joten ajattelin kokeilla kirjoittaa kenttään seuraavaksi:

'OR 1=1; -- ' ja painoin lähetä. Nyt tapahtui jotakin uutta. Salasanaksi tuli foo..


<img width="764" height="664" alt="image" src="https://github.com/user-attachments/assets/fb365372-6b8a-4391-adcc-e416bcb2f2a4" />


Teron ohjeita seuratessa mainittii seuraavaksi jotain tuosta LIMIT asiasta, jolla saisi ilmeisesti jotain muuta ulos taulukosta, kuin pelkästään ensimmäisen rivin tms..

Kokeilin siis ' OR 1=1 LIMIT 2,1; -- ' , eli ilmeisesti tämä tekisi seuraavaa:

        OR 1=1 lauseke kertoo , että WHERE on aina TRUE eli totta

        LIMIT 2,1 näyttää tuloksia alkaen riviltä 2 ja näyttää yhden rivin, eli ainoastaan sen rivin 2.

        ;    lopettaa lausekkeen

        --   kommentoi kaiken muun tämän jälkeen pois, jolloin esim. password kenttään ei tarvitsisi kirjoittaa mitään ( Portswigger,Lab: SQL injection vulnerability allowing login bypass)
        

<img width="662" height="670" alt="image" src="https://github.com/user-attachments/assets/e7e74438-2acf-4063-930a-955afd104575" />


Noniin, nyt sain jotain muutakin tulosta aikaiseksi ja löytyi tuo SUPERADMIN rivi.




















># b)

Olin tämän kanssa täysin jumissa ja homma edistyikin vasta, kun palautin oman tehtäväni ja sain arvioitavaksi kurssilaisen työn. Tämän luettuani 

pääsin etenemään ja tekemään muutoksen lähdekoodiin:

Pysäytin ohjelman suorittamisen CTRL+C ja avasin textieditorilla ohjelman

<img width="1118" height="99" alt="image" src="https://github.com/user-attachments/assets/907e4084-656b-4c3e-a5f3-80db7dbc35b9" />

Nykyisen koodin ongelma on siinä, että se on altis SQL injektioille.

        sql = "SELECT password FROM pins WHERE pin='"+pin+"';"
        res = db.session.execute(text(sql))

SQLAlchemy tukee turvallisia parametreja **:nimi**-syntaksilla. Tämä estää injektiot.

Korjataan siis koodin pätkä

        sql = "SELECT password FROM pins WHERE pin='"+pin+"';"
        	row = ""
        	with app.app_context():
        		res=db.session.execute(text(sql))
        		db.session.commit()
        		row = res.fetchone()

Muotoon: 

        sql = "SELECT password FROM pins WHERE pin = :pin;"
        	row = ""
        	with app.app_context():
        		res=db.session.execute(text(sql), {'pin':pin})
        		db.session.commit()
        		row = res.fetchone()


    >Mikä muuttui?

## Ennen:

        sql = "SELECT password FROM pins WHERE pin='"+pin+"';"

    - Rakentaa SQL-lauseen suoraan merkkijonolla.

    - Jos käyttäjä antaa pin="123' OR '1'='1", koko tietokanta voi vuotaa (SQL injection).

    - Ei parametreja – arvo liitettiin suoraan SQL:ään (...WHERE pin='"+pin+"').

## Nyt:

        sql = text("SELECT password FROM pins WHERE pin = :pin")

        res = db.session.execute(sql, {"pin": pin})

    - Arvo annetaan sanakirjana, SQLAlchemy huolehtii sen oikeasta käsittelystä.
    
    - Käytetään paikkamerkkiä :pin, eikä arvoa liitetä suoraan merkkijonoon.



<img width="920" height="132" alt="image" src="https://github.com/user-attachments/assets/e1a96f5c-a21b-477a-93d6-1bebc1d7a887" />

Save and exit ja testaus toimiiko sama injektio vielä.

<img width="1054" height="730" alt="image" src="https://github.com/user-attachments/assets/1114d777-75e7-45a5-a462-ffae18db536d" />


Ei toiminut, joten haavoittuvuus tuli nyt korjattua.











Lähde : https://github.com/kreatiini/Sovellusten-hakkerointi-ja-haavoittuvuudet24/blob/main/h2%20Break%20%26%20Unbreak.md ( Kiitos vaan paljon vinkistä)


># c)

Aloin suorittamaan tehtävää lukemalla Teron artikkelin Fuffista ja ohjeiden mukaisesti aloin syöttämään komentoja.

        $ sudo apt-get update
        $ sudo apt-get install ffuf

<img width="882" height="47" alt="image" src="https://github.com/user-attachments/assets/91dbbb38-e424-42b9-a2d5-46ec05cd8294" />

<img width="753" height="98" alt="image" src="https://github.com/user-attachments/assets/9223c879-5642-48db-9b05-04779ff9b84d" />

Testasin vielä, että ffuf asentui koneelle ja löytyy:

        ffuf -h    ( FFUF:n ohjesivu)

<img width="817" height="406" alt="image" src="https://github.com/user-attachments/assets/c1f2592d-a092-4c80-b73c-2865803c8054" />


Seuraavaaksi pitäisi saada sanakirjoja jostain, joko lataamalla suoraan valmiita tai tekemällä uusia itse. Tähän voitaisiin käyttää seuraavia komentoja hyödyksi:

        secret/
        .svn/
        dashboard/

Päätin kuitenkin ladata ainakin aluksi tuon common.txt -tiedoston:

        $ wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt

Ja sieltähän se tuli:

<img width="829" height="292" alt="image" src="https://github.com/user-attachments/assets/51175d2b-dfcb-45d9-a9d7-9af5c936e9fa" />

Seuraavaksi oli vuorossa komentojen testausta, joten ohjeen mukaisesti irrotin virtuaalikoneen nyt tässä kohtaa internetistä:

<img width="315" height="153" alt="image" src="https://github.com/user-attachments/assets/1f372d1c-3448-4486-919a-d58e45cc3dc8" />


Ohjeessa luki komennon edessä tuo ./ , mutta tätä käyttämällä tuli virheilmoitus:

<img width="789" height="39" alt="image" src="https://github.com/user-attachments/assets/93f37de5-20c9-4861-a422-543e8377a420" />

Nopealla googlauksella pitäisi kokeilla suoraan ffuf.... joten testataan sitä seuraavaksi:

        ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ

Nyt tapahtui jotain ainakin, en ole ihan varma, että mitä :)

<img width="1793" height="473" alt="image" src="https://github.com/user-attachments/assets/c6c9d91f-5948-49eb-b3e1-f01ae1af88ca" />

Ilmeisesti homma ei toiminut oikein jostain syystä, koska en saanut mitään tuloksia?

Kokeilin curlata osoitetta 127.0.0.2:8000

<img width="749" height="75" alt="image" src="https://github.com/user-attachments/assets/3ee24dd9-409b-4102-8492-1a89b6958ec3" />

MItään ei pyöri siellä. Tässä kohtaa katsoin ohjetta alusta tarkemmin ja huomasin, että olin skipannut osan, jossa tuo testimaali pystytetään

toimintaan. Teen sen siis nyt.

Teron ohje:

        $ wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-0
        $ chmod u+x dirfuzt-0
        $ ./dirfuzt-0

Ekalla kertaa unohtui, että meillä ei ole nettiä, joten se päälle ja komento uusiksi:

<img width="714" height="413" alt="image" src="https://github.com/user-attachments/assets/655815fa-a969-4272-87a4-06d272b7ea13" />

Sitten oikeuksia ja palvelin pyörimään ( ja se netti samalla takaisin pois)

<img width="512" height="93" alt="image" src="https://github.com/user-attachments/assets/53c03791-1472-4eaa-ba01-65d5bc5087d9" />

<img width="411" height="145" alt="image" src="https://github.com/user-attachments/assets/f4a5c5ac-27c9-4575-83ec-d57703c41354" />

<img width="1439" height="443" alt="image" src="https://github.com/user-attachments/assets/95a8db63-55d3-42c8-aeaa-92ea8c9ed2de" />

Kokeilin tulosteen lopusta löytynyttä urlia /admin.

<img width="1055" height="198" alt="image" src="https://github.com/user-attachments/assets/ff516694-cd34-4117-b0ae-631c75d61ca2" />

Kokeilin suodattaa seuraavaksi ohjeen mukaisesti tulostetta ja sieltä pois 132 bittiset vastaukset ja nyt nähtiinkin jo etusivu yhdellä kertaa :D

<img width="1233" height="627" alt="image" src="https://github.com/user-attachments/assets/426fbe9f-80e1-4934-a83c-c18930752bed" />



Seuraavana olisi vuorossa löytää toisesta maalista jotain, eli latasin sen seuraavaksi:

<img width="1121" height="147" alt="image" src="https://github.com/user-attachments/assets/fbc0e29a-58ae-4f16-a900-6835da237fda" />

<img width="502" height="143" alt="image" src="https://github.com/user-attachments/assets/0d1a221b-f7fc-4f77-9f9e-1e5448713aa4" />

Nyt on maali asennettu ja päällä edellä kerrottujen ohjeiden mukaisesti ( dirfutz-0):

<img width="756" height="131" alt="image" src="https://github.com/user-attachments/assets/f1234cde-e440-4e0b-9d6c-1049e20e3d2b" />

Ajoin ffufin maaliin ja tulos näytti tältä suunnilleen:

<img width="1438" height="238" alt="image" src="https://github.com/user-attachments/assets/88528d14-d2c7-470c-8bc8-4d3f77da3cf5" />

Voisinkin kokeilla karsia tuosta pois nyt noita 154bittiä suuria vastauksia..

<img width="1290" height="455" alt="image" src="https://github.com/user-attachments/assets/e1360928-f083-4576-abe2-4feeb3a73cc9" />

Ja asieltä löytyikin nyt Admin osoite ilmeisesti.

<img width="1117" height="247" alt="image" src="https://github.com/user-attachments/assets/76e75948-27aa-43e0-93b7-8b4572f1d421" />

Ja lippu löytyi, aikaa tähän maaliin meni tuon ensimmäisen harjoituksen tehtyäni ainoastaan n. 2minuuttia. en sitten tiedä onko se paljon vai vähän. Itse olen tyytyväinen tähän kuitenkin

<img width="1156" height="241" alt="image" src="https://github.com/user-attachments/assets/00b8f2f0-37b5-4455-a521-afbd8e76138c" />




















># d)

># e)

># f)

># g)

># h)

Aloitin tehtävien tekemise

## Lähteet

Portswigger Academy, Access control vulnerabilities and privilege escalation, 2025. Luettavissa: https://portswigger.net/web-security/access-control. Luettu 29.8.2025

Lab: SQL injection vulnerability allowing login bypass, youtube: https://www.youtube.com/watch?v=ML3aGaloczI

Tero Karvinen, https://terokarvinen.com/hack-n-fix/

Tero Karvinen, https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/

